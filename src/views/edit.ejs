<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update A User</title>
    <link rel="stylesheet" href="/css/style.css">
</head>

<body>
    <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/create">Create Users</a></li>
    </ul>
    <div class="form">
        <form>
            <fieldset>
                <legend>Update a User</legend>
                <div class="input-group">
                    <label for="">id:</label>
                    <input id="id" type="text" readonly value="<%= userEdit.id%>" name="id">
                </div>
                <div class="input-group">
                    <label for="">Email:</label>
                    <input id="email" type="text" value="<%= userEdit.email%>" name="email">
                </div>
                <div class="input-group">
                    <label for="">Name:</label>
                    <input id="name" type="text" value="<%= userEdit.name%>" name="uName">
                </div>
                <div class="input-group">
                    <label for="">City:</label>
                    <input id="city" type="text" value="<%= userEdit.city%>" name="city">
                </div>
                <div>
                    <button type="button" onclick="handleUpdateUser()">
                        Save
                    </button>
                </div>
            </fieldset>
        </form>
    </div>
</body>

<script>
    const handleUpdateUser = async () => {
        const updateData = {
            id: document.getElementById('id').value,
            email: document.getElementById('email').value,
            uName: document.getElementById('name').value,
            city: document.getElementById('city').value,
        };

        if (confirm("Bạn có chắc chắn muốn cập nhật người dùng ID " + updateData.id + " không?")) {
            try {
                // 2. Gửi yêu cầu Fetch (POST) với Body JSON
                const response = await fetch('/update-user', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(updateData), // Gửi dữ liệu cập nhật
                });

                // 3. Kiểm tra phản hồi
                if (response.ok) {
                    alert('Cập nhật thành công!');
                    // Chuyển hướng về trang chủ
                    window.location.href = '/';
                } else {
                    // Đọc lỗi chi tiết từ Server nếu có
                    const errorData = await response.json();
                    alert('Lỗi sửa dữ liệu trên Server: ' + (errorData.message || response.statusText));
                }
            } catch (error) {
                console.error("Lỗi Fetch hoặc kết nối:", error);
                alert('Lỗi kết nối mạng.');
            }
        }
    }
</script>

</html>